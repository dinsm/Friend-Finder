<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" media="screen" title="no title">
    <!--<link rel="stylesheet" href="/css/style.css" media="screen" title="no title">-->
    <script   src="https://code.jquery.com/jquery-3.1.1.js"   integrity=""   crossorigin="anonymous"></script>
    <script   src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"   integrity=""   crossorigin="anonymous"></script>
    <script type="text/javascript" src="./app/data/friend.js"></script>
    <meta charset="utf-8">
    <title>Friend Finder App</title>
</head>
<body>
<div class="container">
    <div class="jumbotron" id="surveytron">
        <h1 class="text-center">Find A Friend</h1>
    </div>


    <div class="row">
        <div class="col-xs-12">
            <form>
                <div id="name-group" class="form-group">
                    <label>Name (required)</label>
                    <input type="text" class="form-control" id="nameForm" placeholder="John Smith">
                    <span id="name-span" aria-hidden="true"></span>
                </div>
                <div id="photo-group" class="form-group">
                    <label>Link to Photograph (required)</label>
                    <input type="text" class="form-control" id="photoForm" placeholder="www.example.com/photo">
                    <span id="photo-span" aria-hidden="true"></span>
                </div>
            </form>
        </div>
    </div>


    <hr id="survery-hr">


    <div class="row">
        <div class="col-xs-12">
            <div class="panel panel-default">
                <div class="panel-heading" id="panel-top"> Personality Test</div>
                <div class="panel-body">
                    <form>
                        <div class="form-group">
                            <label>I prefer fill out this form than go out meet some people.</label>
                            <select class="form-control" class="chosen-select" id="question1">
                                <option>1 (strongly disagree)</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5 (strongly agree)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>I prefer read a trilogy of books than watch the movie</label>
                            <select class="form-control" class="chosen-select" id="question2">
                                <option>1 (strongly disagree)</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5 (strongly agree)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>I dance more than I walk.</label>
                            <select class="form-control" class="chosen-select" id="question3">
                                <option>1 (strongly disagree)</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5 (strongly agree)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>I prefer to watch GOT than work out.</label>
                            <select class="form-control" class="chosen-select" id="question4">
                                <option>1 (strongly disagree)</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5 (strongly agree)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>I spend more hours on my hair than to cook diner.</label>
                            <select class="form-control" class="chosen-select" id="question5">
                                <option>1 (strongly disagree)</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5 (strongly agree)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>I like to participate to an event than to stay home with myself.</label>
                            <select class="form-control" class="chosen-select" id="question6">
                                <option>1 (strongly disagree)</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5 (strongly agree)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>I prefer work on my computer than on a whiteboard.</label>
                            <select class="form-control" class="chosen-select" id="question7">
                                <option>1 (strongly disagree)</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5 (strongly agree)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>I prefer a pen than a keyboard.</label>
                            <select class="form-control" class="chosen-select" id="question8">
                                <option>1 (strongly disagree)</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5 (strongly agree)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>I would like to read more regular book than fix broken code.</label>
                            <select class="form-control" class="chosen-select" id="question9">
                                <option>1 (strongly disagree)</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5 (strongly agree)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>I would prefer water or energy drink.</label>
                            <select class="form-control" class="chosen-select" id="question10">
                                <option>1 (strongly disagree)</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5 (strongly agree)</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-md btn-danger btn-block" id="submit-button"> <!--disabled="true-->
                            <span class="glyphicon glyphicon-send"></span> Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Match Modal -->
    <div class="modal fade" id="modal-result" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <!-- "X" Button to close the modal -->
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h1 class="modal-title text-center">You have a match!</h1>
                </div>

                <!-- Modal Body (For Match Info) -->
                <div class="modal-body">
                    <h1 id="match-name" class="text-center"></h1>
                    <img src="#" alt="" id="match-image" class="img-responsive">
                    <h4 id="message" class="text-center"></h4>
                </div>

                <!-- Modal Footer (Close Button) -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

</div>



<!-- JavaScript for Submission Logic -->
<script>
    // Global Variable Declaration (scoping fix)
    var allFieldsCompleted;
    $(document).ready(function() {
        // Event Listener for Submission
        $("#submit-button").on("click", function() {

            // Check if all the user fields are completed
            checkIfComplete(function(){
                // Proceed with AJAX call if all questions are answered
                if(allFieldsCompleted){
                    collectInputs();
                }
                else{
                    alert("Please complete all fields before submitting!");
                }
            }); // end checkIfComplete() callback
        }); // end submit listener
    }); // document ready

    // Function to valid user input
    function checkIfComplete(callback){
        // Check through all the questions (i.e. iterate through all of class "chosen-select")
        var questionsCompleted;
        $(".chosen-select").each(function(){
            if ( $(this).val() === "" ){
                questionsCompleted = false;
            }
        })
        // This counters the async behavior of $.each()
            .promise().done(function(){
            // Check if any questions are incomplete
            if(questionsCompleted === false){
                allFieldsCompleted = false;
            }
            // Determine if Name is entered
            else if( $("#nameForm").val().trim() === "" ){
                allFieldsCompleted = false;
            }
            // Determine if Link is entered
            else if( $("#photoForm").val().trim() === "" ){
                allFieldsCompleted = false;
            }
            // Otherwise, the all fields are completed
            else{
                allFieldsCompleted = true;
            }
            // Fire Off Callback (to counter async behavior of $.each)
            callback();
        });
    }
    function collectInputs(){
        // Make new friend object
        var newFriend = {
            name: $("#nameForm").val().trim(),
            photo: $("#photoForm").val().trim(),
            scores: []
        };
        // Loop through Questions to get scores
        var scoresArray = [];
        $(".chosen-select").each(function(){
            scoresArray.push( parseInt( $(this).val() ) ); // Parse Input Value as integer
        })
        // This counters the async behavior of $.each()
            .promise().done(function(){

            // Push the array of scores to the new friend object
            newFriend.scores = scoresArray;
            // POST the newFriend to the friends.js file and get back the best match
            var currentURL = window.location.origin;
            $.post(currentURL + "/api/friends", newFriend, function(data){
                // Add Best Match attributes to Modal
                $("#match-name").text(data.name);
                $("#match-image").attr("src", data.photo);
                // Show the modal with the best match
                $("#modal-result").modal("toggle");
            }); // end AJAX POST
        });
    }

    </script>
</body>


</html>